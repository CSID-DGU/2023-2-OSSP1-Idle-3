<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>chart.js</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    .div_style{
      display: flex;
      justify-content: center;
      align-items: center;
      height: 300px;
      /* width: 500px; */
      /* width: 600px; */
    }
    .text_style{
      margin:10px;
    }
    .blank{
      width: 300px;
    }
    .canvas{
      /* width: 100px;
      height: 10px; */
    }
    .div_column{
      flex-direction: column;
    }
  </style>
</head>
<body>
  <div class="div_style">
    <div class="div_style">
      <canvas id="myChart3" class="canvas"></canvas>
      <div class="div_column">
        <h2 id="percentage3" class="text_style">hi</h2>
        <h2 id="gap2" class="text_style">hi</h2>
      </div>
    </div>
    <div class="div_style">
      <canvas id="myChart4" class="canvas"></canvas>
      <div class="div_column">
        <h2 id="percentage4" class="text_style">hi</h2>
        <h2 id="sum2" class="text_style">hi</h2>
      </div>
    </div>
  </div>
  <div class="div_style">
    <div class="div_style">
      <canvas id="myChart1" class="canvas"></canvas>
      <div class="div_column">
        <h2 id="percentage1" class="text_style">hi</h2>
        <h2 id="gap1" class="text_style">hi</h2>
      </div>
    </div>
    <div class="div_style">
      <canvas id="myChart2" class="canvas"></canvas>
      <div class="div_column">
        <h2 id="percentage2" class="text_style">hi</h2>
        <h2 id="sum1" class="text_style">hi</h2>
      </div>
    </div>
  </div>
  <div class="div_style">
    <div class="div_style">
      <canvas id="myChart5" class="canvas"></canvas>
      <div class="div_column">
        <h2 id="percentage5" class="text_style">hi</h2>
        <h2 id="gap3" class="text_style">hi</h2>
      </div>
    </div>
    <div class="div_style">
      <canvas id="myChart6" class="canvas"></canvas>
      <div class="div_column">
        <h2 id="percentage6" class="text_style">hi</h2>
        <h2 id="sum3" class="text_style">hi</h2>
      </div>
    </div>
  </div>
  <div>
    <h2 id="total_gap_percent"></h2>
    <h2 id="total_sum_percent"></h2>
  </div>
  <div class="blank">

  </div>
  
  
  <script>
    function makeChart(data, name, target, ctx){
      chart = new Chart(ctx, {
          type: 'line',
          data: {//
              // x축 항목들
              labels: Array.from({ length: data[name][target].length}, (_, index) => index),
              // 실제 차트에 표시할 데이터들(Array), dataset 객체들을 담고 있다.
              datasets: [{
                  pointRadius: 0,
                  label: name,// gap or sum
                  data: data[name][target],
                  // dataset 배경색
                  backgroundColor: [
                      'rgba(255, 99, 132, 0)'
                  ],
                  // dataset 선 색
                  borderColor: [
                      'rgba(54, 162, 235, 1)'
                  ],
                  // 선 두께
                  borderWidth: 1
              },
              {
                  label: '기존 알고리즘',
                  data: data["original"][target],
                  pointRadius: 0,
                  // dataset 배경색
                  backgroundColor: [
                    'rgba(54, 162, 235, 0)'
                  ],
                  // dataset 선 색
                  borderColor: [
                      'rgba(255, 99, 132, 1)'
                  ],
                  // 선 두께
                  borderWidth: 1
              }]
          },
          // 차트 설정
          options: {
              plugins: {
                title: {
                  display: true,
                  text: target
                }
              },
              parsing: {
                xAxisKey: 'id',
                yAxiskey: 'nested.value'
              },
              // 축에 관한 설정
              scales: {
                  // y축 설정: 최소값이 0보다 크더라도 0부터 시작하도록
                  // y: {
                  //     beginAtZero: true
                  // }
                  y: {
                    min: -5000,
                    max: 8000
                  }
              }
          }
      });
      return chart
    }

    function percent(child, parent){
      return (child/parent * 100).toFixed(2);
    }

    function calculateAverage(arr) {
      const sum = arr.reduce((acc, val) => acc + val, 0);
      const average = sum / arr.length;
      return parseInt(average.toFixed(2));
    }

    // 알고리즘 데이터
    const algorData = {
            "stdOnlyAlgorithm":{
              "gap": [],
              "sum": []
            },
            "weightAlgorithm":{
              "gap": [],
              "sum": []
            },
            "distanceOnlyAlgorithm":{
              "gap": [],
              "sum": []
            },
            "original": {
              "gap": [],
              "sum": []
            }
          };//regularPolygon
    const jsonFilePath = "regularPolygon.json";
    // json 파일 읽어오기
    fetch(jsonFilePath)
      .then(response => response.json())
      .then(data => {
          // const n = data[0]["start"].length;
          const n = 1;
          const count = [0, 0, 0, 0, 0, 0];
          //데이터 가공 후 집어 넣기
          for(let i=0;i<data.length;i++){
            item = data[i];
            origin_gap = item["original"]["gap"];
            origin_sum = item["original"]["sum"];

            algor1_gap = item["stdOnlyAlgorithm"]["gap"];
            algor1_sum = item["stdOnlyAlgorithm"]["sum"];
            algor2_gap = item["weightAlgorithm"]["gap"];
            algor2_sum = item["weightAlgorithm"]["sum"];
            algor3_gap = item["distanceOnlyAlgorithm"]["gap"];
            algor3_sum = item["distanceOnlyAlgorithm"]["sum"];

            if(algor1_gap < origin_gap){
              count[0]++;
            }
            if(algor1_sum < origin_sum){
              count[1]++;
            }
            if(algor2_gap < origin_gap){
              count[2]++;
            }
            if(algor2_sum < origin_sum){
              count[3]++;
            }
            if(algor3_gap < origin_gap){
              count[4]++;
            }
            if(algor3_sum < origin_sum){
              count[5]++;
            }

            algorData["stdOnlyAlgorithm"]["gap"].push(algor1_gap);
            algorData["stdOnlyAlgorithm"]["sum"].push(algor1_sum);
            algorData["weightAlgorithm"]["gap"].push(algor2_gap);
            algorData["weightAlgorithm"]["sum"].push(algor2_sum);
            algorData["distanceOnlyAlgorithm"]["gap"].push(algor3_gap);
            algorData["distanceOnlyAlgorithm"]["sum"].push(algor3_sum);
            algorData["original"]["gap"].push(origin_gap);
            algorData["original"]["sum"].push(origin_sum);
          }

          const ctx1 = document.getElementById('myChart1').getContext('2d');
          const ctx2 = document.getElementById('myChart2').getContext('2d');
          const ctx3 = document.getElementById('myChart3').getContext('2d');
          const ctx4 = document.getElementById('myChart4').getContext('2d');
          const ctx5 = document.getElementById('myChart5').getContext('2d');
          const ctx6 = document.getElementById('myChart6').getContext('2d');

          // 평균 구하기
          avg_origin_gap = calculateAverage(algorData["original"]["gap"]);
          avg_origin_sum = calculateAverage(algorData["original"]["sum"]);
          avg_stdOnly_gap = calculateAverage(algorData["stdOnlyAlgorithm"]["gap"]);
          avg_weight_gap = calculateAverage(algorData["weightAlgorithm"]["gap"]);
          avg_distanceOnly_gap = calculateAverage(algorData["distanceOnlyAlgorithm"]["gap"]);
          avg_stdOnly_sum = calculateAverage(algorData["stdOnlyAlgorithm"]["sum"]);
          avg_weight_sum = calculateAverage(algorData["weightAlgorithm"]["sum"]);
          avg_distanceOnly_sum = calculateAverage(algorData["distanceOnlyAlgorithm"]["sum"]);

          for (let i = 0; i<6; i++){
            // document.getElementById(`percentage${i+1}`).textContent = percent(count[i], algorData["original"]["gap"].length) + '%';
            // document.getElementById(`percentage${i+1}`).textContent = percent(avg_stdOnly_gap, avg_origin_gap) + '%';
          }
          // 알고리즘 각각의 percent 구하기
          document.getElementById('percentage1').textContent = percent(avg_origin_gap - avg_stdOnly_gap, avg_origin_gap) + '%';
          document.getElementById('percentage2').textContent = percent(avg_origin_sum - avg_stdOnly_sum, avg_origin_sum) + '%';
          document.getElementById('percentage3').textContent = percent(avg_origin_gap - avg_weight_gap, avg_origin_gap) + '%';
          document.getElementById('percentage4').textContent = percent(avg_origin_sum - avg_weight_sum, avg_origin_sum) + '%';
          document.getElementById('percentage5').textContent = percent(avg_origin_gap - avg_distanceOnly_gap, avg_origin_gap) + '%';
          document.getElementById('percentage6').textContent = percent(avg_origin_sum - avg_distanceOnly_sum, avg_origin_sum) + '%';

          // 전체 percent 계산
          avg_total_new_gap = (avg_stdOnly_gap + avg_weight_gap + avg_distanceOnly_gap)/3;
          avg_total_new_sum = (avg_stdOnly_sum + avg_weight_sum + avg_distanceOnly_sum)/3;

          // 전체 percent 
          document.getElementById('total_gap_percent').textContent = '전체 편차 절약: ' + percent(avg_origin_gap - avg_total_new_gap, avg_origin_gap) + '%';
          document.getElementById('total_sum_percent').textContent = '전체 이동시간 절약: ' + percent(avg_origin_sum - avg_total_new_sum, avg_origin_sum) + '%';

          // 각각의 절약된 편차, 이동시간 계산
          document.getElementById('gap1').textContent = '평균 편차 ' + ((avg_origin_gap - avg_stdOnly_gap)/n).toFixed(2) + '초 절약';
          document.getElementById('gap2').textContent = '평균 편차 ' + ((avg_origin_gap - avg_weight_gap)/n).toFixed(2) + '초 절약';
          document.getElementById('gap3').textContent = '평균 편차 ' + ((avg_origin_gap - avg_distanceOnly_gap)/n).toFixed(2) + '초 절약';
          document.getElementById('sum1').textContent = '평균 이동시간 ' + ((avg_origin_sum - avg_stdOnly_sum)/n).toFixed(2) + '초 절약';
          document.getElementById('sum2').textContent = '평균 이동시간 ' + ((avg_origin_sum - avg_weight_sum)/n).toFixed(2) + '초 절약';
          document.getElementById('sum3').textContent = '평균 이동시간 ' + ((avg_origin_sum - avg_distanceOnly_sum)/n).toFixed(2) + '초 절약';
          
          // 차트 생성
          const myChart1 = makeChart(algorData, "stdOnlyAlgorithm", "gap", ctx1);
          const myChart2 = makeChart(algorData, "stdOnlyAlgorithm", "sum", ctx2);
          const myChart3 = makeChart(algorData, "weightAlgorithm", "gap", ctx3);
          const myChart4 = makeChart(algorData, "weightAlgorithm", "sum", ctx4);
          const myChart5 = makeChart(algorData, "distanceOnlyAlgorithm", "gap", ctx5);
          const myChart6 = makeChart(algorData, "distanceOnlyAlgorithm", "sum", ctx6);
        });
    
    
  </script>
</body>
</html>